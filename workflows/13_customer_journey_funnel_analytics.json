{
  "name": "ğŸ“Š Customer Journey Funnel Analytics Agent",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 4
            }
          ]
        }
      },
      "id": "funnel-trigger",
      "name": "â° Every 4 Hours Analytics",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [240, 300],
      "notes": "ğŸ”¥ DEMO: Comprehensive funnel analysis every 4 hours\nğŸ’° ROI: 15-25% conversion improvement\nâš¡ Impact: Data-driven optimization insights"
    },
    {
      "parameters": {
        "url": "https://analyticsdata.googleapis.com/v1beta/properties/{{$credentials.googleAnalytics.propertyId}}:runReport",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleAnalyticsOAuth2Api",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "dateRanges",
              "value": "=[{\"startDate\": \"30daysAgo\", \"endDate\": \"today\"}]"
            },
            {
              "name": "dimensions",
              "value": "=[{\"name\": \"pagePath\"}, {\"name\": \"sessionDefaultChannelGrouping\"}, {\"name\": \"deviceCategory\"}]"
            },
            {
              "name": "metrics",
              "value": "=[{\"name\": \"sessions\"}, {\"name\": \"bounceRate\"}, {\"name\": \"averageSessionDuration\"}, {\"name\": \"goalCompletionsAll\"}]"
            },
            {
              "name": "dimensionFilter",
              "value": "=[{\"filter\": {\"fieldName\": \"pagePath\", \"stringFilter\": {\"matchType\": \"BEGINS_WITH\", \"value\": \"/\"}}}]"
            }
          ]
        }
      },
      "id": "google-analytics",
      "name": "ğŸ“ˆ Google Analytics Data",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [460, 200],
      "notes": "Collects website behavior data\nTracks: Page views, sessions, conversions, bounce rates"
    },
    {
      "parameters": {
        "url": "https://api.hubapi.com/crm/v3/objects/contacts/search",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "hubspotOAuth2Api",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "filterGroups",
              "value": "=[{\"filters\": [{\"propertyName\": \"createdate\", \"operator\": \"GTE\", \"value\": \"{{new Date(Date.now() - 30*24*60*60*1000).toISOString()}}\"}]}]"
            },
            {
              "name": "properties",
              "value": "=[\"firstname\", \"lastname\", \"email\", \"hs_lead_status\", \"lifecyclestage\", \"hs_analytics_source\", \"hs_analytics_source_data_1\", \"hs_analytics_source_data_2\"]"
            },
            {
              "name": "limit",
              "value": "100"
            }
          ]
        }
      },
      "id": "hubspot-crm",
      "name": "ğŸ¯ HubSpot CRM Data",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [460, 400],
      "notes": "Collects customer lifecycle data\nTracks: Lead status, lifecycle stage, source attribution"
    },
    {
      "parameters": {
        "url": "https://api.sendgrid.com/v3/marketing/contacts/search",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "sendGridApi",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "LAST_CLICKED >= '{{new Date(Date.now() - 30*24*60*60*1000).toISOString().split('T')[0]}}'"
            }
          ]
        }
      },
      "id": "email-marketing",
      "name": "ğŸ“§ Email Marketing Data",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [460, 600],
      "notes": "Collects email engagement data\nTracks: Open rates, click-through rates, conversions"
    },
    {
      "parameters": {
        "url": "https://graph.facebook.com/v18.0/{{$credentials.facebook.pageId}}/insights",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "facebookGraphApi",
        "options": {
          "queryParameters": {
            "parameters": [
              {
                "name": "metric",
                "value": "page_impressions,page_engaged_users,page_post_engagements,page_fans_online_per_day"
              },
              {
                "name": "period",
                "value": "day"
              },
              {
                "name": "since",
                "value": "{{new Date(Date.now() - 30*24*60*60*1000).toISOString().split('T')[0]}}"
              },
              {
                "name": "until",
                "value": "{{new Date().toISOString().split('T')[0]}}"
              }
            ]
          }
        }
      },
      "id": "social-media",
      "name": "ğŸ“± Social Media Engagement",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [460, 800],
      "notes": "Collects social media interaction data\nTracks: Impressions, engagements, fan growth"
    },
    {
      "parameters": {
        "model": "gemini-2.0-flash-exp",
        "prompt": "=You are an expert conversion rate optimization analyst. Analyze this comprehensive customer journey data and provide actionable insights.\n\nWebsite Analytics: {{$json.analytics || 'No analytics data'}}\nCRM Data: {{$json.crm || 'No CRM data'}}\nEmail Data: {{$json.email || 'No email data'}}\nSocial Data: {{$json.social || 'No social data'}}\n\nAnalyze the complete customer funnel and provide:\n\n1. **Funnel Performance Summary**\n   - Overall conversion rate trends\n   - Key drop-off points\n   - Channel performance comparison\n\n2. **Customer Segmentation Insights**\n   - High-value customer characteristics\n   - At-risk customer identification\n   - Behavioral patterns\n\n3. **Optimization Recommendations**\n   - Specific A/B test suggestions\n   - Content and messaging improvements\n   - Technical optimization opportunities\n   - Personalization strategies\n\n4. **Predictive Analytics**\n   - Next 30-day conversion forecast\n   - Seasonal trend analysis\n   - Growth opportunity identification\n\nFormat as structured JSON with clear sections and actionable recommendations. Focus on data-driven insights with measurable impact potential.",
        "options": {
          "temperature": 0.3,
          "maxTokens": 4000
        }
      },
      "id": "gemini-funnel-analysis",
      "name": "ğŸ§  Gemini Funnel Intelligence",
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1.3,
      "position": [680, 400],
      "notes": "ğŸ¯ Advanced funnel analysis\nğŸ“Š Predictive insights and recommendations\nğŸ² Data-driven optimization strategies"
    },
    {
      "parameters": {
        "jsCode": "// Process AI insights and create actionable funnel metrics\nconst aiResponse = JSON.parse($input.first().json.choices[0].message.content);\n\nconst funnelMetrics = {\n  analysis_timestamp: new Date().toISOString(),\n  summary: aiResponse.funnel_performance_summary,\n  segments: aiResponse.customer_segmentation,\n  recommendations: aiResponse.optimization_recommendations,\n  predictions: aiResponse.predictive_analytics,\n  key_metrics: {\n    total_sessions: aiResponse.total_sessions || 0,\n    conversion_rate: aiResponse.overall_conversion_rate || 0,\n    average_order_value: aiResponse.average_order_value || 0,\n    customer_lifetime_value: aiResponse.customer_lifetime_value || 0\n  },\n  alerts: aiResponse.critical_alerts || [],\n  priority_actions: aiResponse.immediate_actions || []\n};\n\n// Calculate funnel efficiency\nconst funnelEfficiency = {\n  awareness_to_consideration: (funnelMetrics.key_metrics.conversion_rate * 100) / 2,\n  consideration_to_purchase: funnelMetrics.key_metrics.conversion_rate * 100,\n  purchase_to_repeat: 25, // Estimated repeat purchase rate\n  overall_funnel_efficiency: funnelMetrics.key_metrics.conversion_rate * 100\n};\n\nfunnelMetrics.funnel_efficiency = funnelEfficiency;\n\nreturn [{json: funnelMetrics}];"
      },
      "id": "funnel-processor",
      "name": "âš™ï¸ Process Funnel Metrics",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 400],
      "notes": "ğŸ›¡ï¸ Extracts actionable metrics\nğŸ“Š Calculates funnel efficiency\nğŸ”„ Prepares data for visualization"
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "funnel_analytics",
        "columns": "analysis_timestamp, conversion_rate, total_sessions, recommendations, predictions, alerts",
        "additionalFields": {
          "values": "={{$json.analysis_timestamp}}, {{$json.key_metrics.conversion_rate}}, {{$json.key_metrics.total_sessions}}, '{{JSON.stringify($json.recommendations)}}', '{{JSON.stringify($json.predictions)}}', '{{JSON.stringify($json.alerts)}}'"
        }
      },
      "id": "analytics-database",
      "name": "ğŸ’¾ Store Analytics Data",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.4,
      "position": [1120, 300],
      "notes": "ğŸ“ˆ Historical funnel tracking\nğŸ“Š Trend analysis over time\nğŸ” Performance benchmarking"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C1234567890",
          "mode": "list",
          "cachedResultName": "conversion-alerts"
        },
        "text": "=ğŸ“Š **Customer Journey Analytics Update**\n\n**Overall Conversion Rate:** {{$json.key_metrics.conversion_rate.toFixed(2)}}%\n**Total Sessions (30d):** {{$json.key_metrics.total_sessions.toLocaleString()}}\n\n**Funnel Efficiency:**\nâ€¢ Awareness â†’ Consideration: {{$json.funnel_efficiency.awareness_to_consideration.toFixed(1)}}%\nâ€¢ Consideration â†’ Purchase: {{$json.funnel_efficiency.consideration_to_purchase.toFixed(1)}}%\nâ€¢ Overall: {{$json.funnel_efficiency.overall_funnel_efficiency.toFixed(1)}}%\n\n{{$json.priority_actions.length > 0 ? '**ğŸš¨ Priority Actions:**\\n' + $json.priority_actions.slice(0,3).map(action => `â€¢ ${action}`).join('\\n') : ''}}\n\n_Next analysis in 4 hours_",
        "otherOptions": {}
      },
      "id": "slack-summary",
      "name": "ğŸ“± Slack Analytics Summary",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [1120, 500],
      "notes": "ğŸ”” Regular analytics summaries\nğŸ“ˆ Key performance indicators\nğŸ‘¥ Team performance updates"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "critical-alerts",
              "leftValue": "={{$json.alerts.length}}",
              "rightValue": "0",
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combineOperation": "any"
        },
        "options": {}
      },
      "id": "critical-alert-filter",
      "name": "ğŸš¨ Critical Alerts Only",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [1340, 400],
      "notes": "Only processes critical conversion issues"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C1234567890",
          "mode": "list",
          "cachedResultName": "critical-alerts"
        },
        "text": "=ğŸš¨ **CRITICAL CONVERSION ALERT**\n\n{{$json.alerts.map(alert => `ğŸ”´ **${alert.title}**\nâ€¢ Impact: ${alert.impact}\nâ€¢ Details: ${alert.description}\nâ€¢ Recommendation: ${alert.recommendation}\\n`).join('\\n')}}\n\n**Current Conversion Rate:** {{$json.key_metrics.conversion_rate.toFixed(2)}}%\n**Affected Sessions:** {{$json.key_metrics.total_sessions.toLocaleString()}}\n\nâš¡ *Immediate action required*",
        "otherOptions": {}
      },
      "id": "slack-critical-alert",
      "name": "ğŸš¨ Slack Critical Alert",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [1560, 400],
      "notes": "ğŸš¨ Critical conversion drop alerts\nğŸ“ˆ Immediate attention required\nğŸ‘¥ Crisis response notifications"
    },
    {
      "parameters": {
        "fromEmail": "analytics@yourcompany.com",
        "toEmail": "marketing@yourcompany.com,growth@yourcompany.com",
        "subject": "=ğŸ“Š Weekly Customer Journey Analytics Report - {{new Date().toLocaleDateString()}}",
        "html": "=<h2>Customer Journey Funnel Analytics Report</h2>\n\n<h3>Key Performance Metrics</h3>\n<ul>\n<li><strong>Overall Conversion Rate:</strong> {{$json.key_metrics.conversion_rate.toFixed(2)}}%</li>\n<li><strong>Total Sessions (30d):</strong> {{$json.key_metrics.total_sessions.toLocaleString()}}</li>\n<li><strong>Average Order Value:</strong> ${{$json.key_metrics.average_order_value.toFixed(2)}}</li>\n<li><strong>Customer Lifetime Value:</strong> ${{$json.key_metrics.customer_lifetime_value.toFixed(2)}}</li>\n</ul>\n\n<h3>Funnel Efficiency</h3>\n<ul>\n<li><strong>Awareness â†’ Consideration:</strong> {{$json.funnel_efficiency.awareness_to_consideration.toFixed(1)}}%</li>\n<li><strong>Consideration â†’ Purchase:</strong> {{$json.funnel_efficiency.consideration_to_purchase.toFixed(1)}}%</li>\n<li><strong>Overall Efficiency:</strong> {{$json.funnel_efficiency.overall_funnel_efficiency.toFixed(1)}}%</li>\n</ul>\n\n<h3>AI Recommendations</h3>\n{{$json.recommendations.slice(0,5).map(rec => `<p><strong>${rec.title}:</strong> ${rec.description}</p>`).join('')}}\n\n<h3>Priority Actions</h3>\n<ul>\n{{$json.priority_actions.map(action => `<li>${action}</li>`).join('')}}\n</ul>\n\n<p><em>Report generated by AI Customer Journey Analytics Agent</em></p>",
        "options": {}
      },
      "id": "weekly-email-report",
      "name": "ğŸ“§ Weekly Analytics Report",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 1,
      "position": [1780, 400],
      "notes": "ğŸ“§ Comprehensive weekly reports\nğŸ“Š Executive-level insights\nğŸ‘” Stakeholder communication"
    }
  ],
  "connections": {
    "â° Every 4 Hours Analytics": {
      "main": [
        [
          {
            "node": "ğŸ“ˆ Google Analytics Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ¯ HubSpot CRM Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“§ Email Marketing Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“± Social Media Engagement",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ˆ Google Analytics Data": {
      "main": [
        [
          {
            "node": "ğŸ§  AI Funnel Intelligence",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¯ HubSpot CRM Data": {
      "main": [
        [
          {
            "node": "ğŸ§  AI Funnel Intelligence",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“§ Email Marketing Data": {
      "main": [
        [
          {
            "node": "ğŸ§  AI Funnel Intelligence",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“± Social Media Engagement": {
      "main": [
        [
          {
            "node": "ğŸ§  AI Funnel Intelligence",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ§  AI Funnel Intelligence": {
      "main": [
        [
          {
            "node": "âš™ï¸ Process Funnel Metrics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âš™ï¸ Process Funnel Metrics": {
      "main": [
        [
          {
            "node": "ğŸ’¾ Store Analytics Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“± Slack Analytics Summary",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸš¨ Critical Alerts Only",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸš¨ Critical Alerts Only": {
      "main": [
        [
          {
            "node": "ğŸš¨ Slack Critical Alert",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“§ Weekly Analytics Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2024-12-30T10:00:00.000Z",
      "updatedAt": "2024-12-30T10:00:00.000Z",
      "id": "conversion-optimization",
      "name": "Conversion Optimization"
    },
    {
      "createdAt": "2024-12-30T10:00:00.000Z",
      "updatedAt": "2024-12-30T10:00:00.000Z",
      "id": "customer-analytics",
      "name": "Customer Analytics"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2024-12-30T10:00:00.000Z",
  "versionId": "1.0.0"
}
